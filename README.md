# Тестовое задание на стажировку в Авито

## Интрукция по командам в Makefile

Сборка и запуск executable локально
```sh
make run
```

Запуск через docker
```sh
make docker-up
```

Выключение docker
```sh
make docker-down
```

Очистка docker
```sh
make docker-rm
```

Запуск swagger-ui для файла из задания
```sh
make swagger-from-task
```

Запуск end-to-end тестов (через docker):
```sh
make e2e-tests
```

## Примеры запросов/ответов

### /auth/register
![](docs/auth_1.png)

### /auth/login
![](docs/auth_2.png)

### /banner

С токеном пользователя

![](docs/banner_1.png)

С токеном админа

![](docs/banner_2.png)

![](docs/banner_3.png)

![](docs/banner_4.png)

С фильтром

![](docs/banner_5.png)

Изменим содержимое

![](docs/banner_6.png)

Проверка того, что содержимое поменялось

![](docs/banner_7.png)

Удалим баннер с id 2

![](docs/banner_8.png)

Проверка, что баннер удалился

![](docs/banner_9.png)

### /user_banner

Получение баннера

![](docs/banner_10.png)

Изменим его содержимое

![](docs/banner_11.png)

Информация старая, потому что сработало кеширование

![](docs/banner_12.png)

Укажем флаг use_last_revision

![](docs/banner_13.png)


## Вопросы/ответы

- Авторизация: решил не делать refresh токены, на это ушло бы много времени
- Во всех 500 ошибках решил не выдавать текст ошибки напрямую из api в целях безопасности
- Для выполнения отложенных трудоемких задач на удаление хотел реализовать worker pool, но не успел :(
- В базе данных во время patch были использованы транзации дабы баннер частично не обновлялся при частичной неудачи запросов к бд
- В swagger файле не было описано ситуации когда создание или обновление баннера может конфликтовать с уже имеющимся (т.к. баннеры должны быть уникально определены по tag_id и feature_id), добавил везде соответствующие статусы кодов
- Выбрал gin как router потому что он все еще проще чем встроенное решение, даже не смотря на последнюю версию go :)
- Для того чтобы избежать дубликатов данных в redis по разным ключам (tag_id и feature_id) я использовал еще один ключ с id баннера как промежуточый
